---
title: "Practicum 3"
output: html_notebook
---


Main objective: Determine what factors contribute to tip amount for NYC taxi drivers.

#All libraries are allowed.

Question 1: 

Part 1: • Load the NYC Green Taxi Trip Records data into a data frame or tibble

```{r}
library(tidyverse)
library(caret)
library(psych)

tripdata.df <- read.csv("2018_Green_Taxi_Trip_Data.csv", header = TRUE)

```

Part 2: • explore the data to identify any patterns and analyze the relationships between the 
features and the target variable i.e. tip amount. At a minimum, you should analyze: 1) the distribution,
2) the correlations 3) missing values and 4) outliers — provide supporting visualizations and explain 
all your steps.

Initial summary statistics are printed below. NA values are counted and a proportion of how many values are missing is calculated. The 
column 'ehail fee' is completely missing, and was removed below. The column "Trip type" is largely in-tact with only three missing
values present, and missing values will be replaced with the most common type of trip (1).

#Use pickup and dropoff time to mutate a new column called triplength
#Since there is only one value for trip_type, it will not be useful in the correlation matrix and has been removed.
#Things strongly correlated to tip amount seem to be the type of payment, the total amount of the ride, and the distance of the trip. 
#Pickup and dropoff locations have a pretty binomial distribution.
#Check for outliers: Passenger_count, trip_distance, fare_amount, tip_amount, tolls_amount, total_amount,

```{r}
#Summary Statistics
glimpse(tripdata.df)
dim(tripdata.df)
summary(tripdata.df)

#Count NA values
for(i in 1:ncol(tripdata.df)){
  print(colnames(tripdata.df[i]))
  print(sum(is.na(tripdata.df[,i])))
  print(as.double(sum(is.na(tripdata.df[,i])) / nrow(tripdata.df)*100))
}

#Handling Missing Values
tripdata.clean <- tripdata.df %>%
  select(-ehail_fee)
tripdata.clean$trip_type <- replace_na(1)


#Conversion of variables to numerics for use in model.
tripdata.clean <- tripdata.clean %>%
  mutate(fare_amount = gsub(",", "", fare_amount)) %>%
    mutate(total_amount = gsub(",", "", total_amount)) %>%
      mutate(fare_amount = as.numeric(fare_amount)) %>%
        mutate(total_amount = as.numeric(total_amount)) %>%
      mutate(lpep_pickup_datetime = as.POSIXct(lpep_pickup_datetime, format = "%m/%d/%Y %H:%M")) %>%
    mutate(lpep_dropoff_datetime = as.POSIXct(lpep_dropoff_datetime, format = "%m/%d/%Y %H:%M")) %>%
  mutate(trip_time = lpep_dropoff_datetime - lpep_pickup_datetime)
  
#Conversion of categorical variables to numeric dummy variables
tripdata.clean$store_and_fwd_flag <- ifelse(tripdata.clean$store_and_fwd_flag == "N", 0, 1)


#Identify correlations between variables 
tripdata.cor <- tripdata.clean %>%
  select(-lpep_pickup_datetime, -lpep_dropoff_datetime, -trip_time, -trip_type)

correlation.matrix <- cor(tripdata.cor)
print(correlation.matrix)

#pairs.panels(tripdata.cor)

for(i in 1:ncol(tripdata.cor)){
  hist(tripdata.cor[,i],
  main = paste("Histogram of", names(tripdata.cor[i])),
  xlab = names(tripdata.cor[i]),
  col = "lightblue")
}

outlier.removal <- function(variable.name) {

  variable.mean <- mean(variable.name)
  variable.sd <- sd(variable.name)
  outlier.df <- abs(variable.mean - variable.name / variable.sd)
  return(outlier.df)
}


```

```{r}
#Test ENV

tripdata.test <- outlier.removal(tripdata.test$tip_amount)
```


























