---
title: "Practicum 02"
output: html_notebook
---

Question 1: Complete the following queries using the customers, orders, and Router_info 
data. You should submit your queries and output in a word document. You will 
also be graded on creativity and complexity.

Question 1-1: Import the data into SQlite by creating 3 tables to host the data (10 points)

All code ran using the SQLite3 command line interface. Each tables was imported using the code listed below. 
For organization and access, each table was added to the database "CustomerDatabase.db". 

.mode csv
.separator ','

CREATE TABLE "Customers" (
	"CustomerID"	INTEGER,
	"FirstName"	TEXT,
	"LastName"	TEXT,
	"StreetAddress"	TEXT,
	"City"	TEXT,
	"State"	TEXT,
	"ZipeCode"	TEXT,
	"Telephone"	TEXT,
	"Purchases_Total"	TEXT,
	PRIMARY KEY("CustomerID")
);

.import customers.csv Customers
SELECT COUNT(*) FROM Customers
.save CustomerDatabase.db


CREATE TABLE Orders (
  "OrderID" INTEGER,
  "CustomerID" INTEGER,
  "SKU" TEXT,
  "Description" TEXT,
  "Cost" TEXT,
  "Year_Purchase" TEXT,
  PRIMARY KEY("OrderID")
);

.import orders.csv Orders
SELECT COUNT(*) FROM Orders
.save CustomerDatabase.db

CREATE TABLE Routers (
  "RMAID" INTEGER,
  "OrderID" INTEGER,
  "Status" TEXT,
  "Step" TEXT,
  "Reason" TEXT,
  "CustomerID" INTEGER,
  PRIMARY KEY("RMAID")
);

.import Router_info.csv Routers
SELECT COUNT(*) FROM Routers
.save CustomerDatabase.db



Question 1-2: Explore the data, what do you see and how would you connect all 3 of these
tables? (2.5 points)

Work performed in R using RSQLite

all tables were connected in a single database file by saving the three imported tables using
.save CustomerDatabase.db in the SQLite3 command line.

Service calls by state and by city are summarized below. Additionally, product stability data 
was generated by joining the results of the router service call to the product SKU, and grouping by 
by the result of the service call. This provides statistics that can be used to determine which router
is most likely to become defective. In this case, it is the Basic Switch 10/100/1000 BaseT 48 port. 

```{r}
library(RSQLite)
library(tidyverse)

db <- dbConnect(SQLite(), 
                dbname = "C:/Users/mastl/Documents/DA5020/sqlite-tools-win32-x86-3380500/CustomerDatabase.db")

#Explore Data

#Count of service calls per State
sqlCmd1 <- "SELECT COUNT(*), State
            FROM Customers
            GROUP BY State;"

#Count of service calls per City
sqlCmd2 <- "SELECT COUNT(*), City
            FROM Customers
            GROUP BY City;"

#
sqlCmd3 <- "SELECT SKU, Description, Reason, COUNT(*) AS Occurance_Number
            FROM (SELECT Orders.*, Routers.*
	                FROM Orders
	                JOIN Routers ON Routers.OrderID = Orders.OrderID)
            GROUP BY SKU, Reason
            ORDER BY Reason, Occurance_Number;"

stateBreakdown <- dbGetQuery(db, sqlCmd1)
print(stateBreakdown)

cityBreakdown <- dbGetQuery(db, sqlCmd2)
print(cityBreakdown)

productBreakdown <- dbGetQuery(db, sqlCmd3)
print(productBreakdown)

#Join all tables

sqlCmd4 <- "SELECT *
            FROM (SELECT Customers.*, Orders.*, Routers.*
	                FROM Customers
	                JOIN Orders on Orders.CustomerID = Customers.CustomerID
	                JOIN Routers on Routers.CustomerID = Customers.CustomerID)"

tableJoin <- dbGetQuery(db, sqlCmd4)
print(tableJoin)
```


Question 1-3: Create a query using Select, where, from on a table of your using (2.5 points)

Below is an example query which searches the table "Customers" for customers with the first name 'Jake'. The query 
returns all information related to customers with the first name Jake that is contained within the Customers table.

```{r}
sqlCmd5 <- "SELECT *
            FROM Customers
            WHERE Customers.FirstName == 'Jake'"

firstNameSearch <- dbGetQuery(db, sqlCmd5)
print(firstNameSearch)
```

Question 1-4: Create a query that joins the tables (5 points)

Below is a query that uses the primary keys CustomerID, OrderID, and RMAID to join all three tables within the database. 

```{r}
sqlCmd6 <- "SELECT *
            FROM (SELECT Customers.*, Orders.*, Routers.*
	                FROM Customers
	                JOIN Orders on Orders.CustomerID = Customers.CustomerID
	                JOIN Routers on Routers.CustomerID = Customers.CustomerID)"

tableJoin <- dbGetQuery(db, sqlCmd6)
print(tableJoin)
```

Question 1-5: Create a left join query (0 points)

```{r}
sqlCmd7 <- "SELECT *
            FROM Customers
            LEFT JOIN Orders ON Customers.CustomerID = Orders.CustomerID;"

leftJoin <- dbGetQuery(db, sqlCmd7)
print(leftJoin)
```











